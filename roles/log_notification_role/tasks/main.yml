---
# Step 1: Start DR PE restore check

# Step 2: Collect logs and append them to a single file
- name: Daily Monitor Logs DR PE restore log status
  shell: | 
     echo "=== Logs from {{ inventory_hostname }} ===" 
     tail -n 10 "{{ log_path }}" 
  ignore_errors: yes  # Continue even if there are issues
  register: all_logs
  #delegate_to: localhost  # Collect logs on the control machine

# Step 3: Append logs to a central file on the controller
- name: Append logs to a central file on the controller
  shell: |
    echo "Start check DR PE restore at: {{ ansible_date_time.iso8601 }}" >> /tmp/all_logs_collected.txt
    echo "{{ all_logs.stdout_lines | default('No logs collected') }}" >> /tmp/all_logs_collected.txt 2>&1
    echo "=== End of logs from {{ inventory_hostname }} ===" >> /tmp/all_logs_collected.txt
  delegate_to: localhost  # Ensure this runs on the controller

# Step 4: Display the collected logs
- name: Display the collected logs
  command: cat /tmp/all_logs_collected.txt
  delegate_to: localhost
  register: consolidated_logs
  run_once: true

# # Step 5: Show the logs in the playbook output
# - name: Show logs in the playbook output
#   debug:
#     msg: "DR PE restore: {{ consolidated_logs }}"
#   run_once: true